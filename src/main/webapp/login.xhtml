<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<f:view contentType="text/html" encoding="UTF-8" oamEnableViewPool="true">
	<h:head>
		<ui:include src="/layout/headCommons.xhtml" />
	</h:head>
	
	<h:body styleClass="login-page">
		<div class="container">
			<h:form id="login" prependId="false">
				<div class="container">
					<div class="row login-logo">
						<div class="col-xs-12">
							<p:graphicImage id="logo" value="/resources/images/logo-large.png" styleClass="animate-0 zoomIn" />
							<div class="version animate-3 fadeIn" style="#{loginController.newVersion ? 'color: #00a55b; font-size: 11px !important;' : 'color: #2e363b;'}">#{version['version']}</div>
						</div>
					</div>

					<ui:param name="isDev" value="#{facesContext.application.projectStage eq 'Development'}" />

					<div class="row login-inner-panel">
						<div class="login-error-message">
							<p:messages />
						</div>
						<div class="row">
							<div class="login-input col-md-12">
								<p:inputText id="username" value="#{loginController.username}" required="#{not isDev}" requiredMessage="#{msg['error.loginRequired']}" label="#{msg['label.username']}" size="50" />
								<p:watermark for="login:username" value="#{msg['label.login']}" />
								<div class="input-icon"><span class="fa fa-at" /></div>
							</div>
						</div>
						<div class="row">
							<div class="login-input col-md-12">
								<p:password id="password" value="#{loginController.password}" required="#{not isDev}" requiredMessage="#{msg['error.passwordRequired']}" label="#{msg['label.password']}" size="50" />
								<p:watermark for="login:password" value="#{msg['label.password']}" />
								<div class="input-icon"><span class="fa fa-lock" /></div>
							</div>
						</div>
						<div class="row">
							<div class="login-input col-xs-#{isDev ? '3' : '12' }">
								<p:commandButton id="loginButton" value="#{msg['button.login']}" process="@form" action="#{loginController.login}" ajax="false" onclick="onLogin()" style="width: 100%;" />
							</div>
							<div class="login-input login-button col-xs-3">
								<p:commandButton value="USER" process="@form" action="#{loginController.login}" ajax="false" rendered="#{isDev}" styleClass="btn-success">
									<f:setPropertyActionListener value="user" target="#{loginController.username}" />
									<f:setPropertyActionListener value="user" target="#{loginController.password}" />
								</p:commandButton>
							</div>
							<div class="login-input login-button col-xs-3">
								<p:commandButton value="ADMIN" process="@form" action="#{loginController.login}" ajax="false" rendered="#{isDev}" styleClass="btn-success">
									<f:setPropertyActionListener value="admin" target="#{loginController.username}" />
									<f:setPropertyActionListener value="admin" target="#{loginController.password}" />
								</p:commandButton>
							</div>
							<div class="login-input login-button col-xs-3">
								<p:commandButton value="DEV" process="@form" action="#{loginController.login}" ajax="false" rendered="#{isDev}" styleClass="btn-success">
									<f:setPropertyActionListener value="thiago" target="#{loginController.username}" />
									<f:setPropertyActionListener value="admin" target="#{loginController.password}" />
								</p:commandButton>
							</div>
						</div>
					</div>
				</div>
        	</h:form>

        	<h:form>
				<p:remoteCommand name="setClientTimeZone" actionListener="#{loginController.setClientTimeZone()}" />
			</h:form>
		</div>
		<script>
			$().ready(function() {
				track('Login page');

				var timeZone = new Date().getTimezoneOffset() / 60 * -1;
				setClientTimeZone([{ name: 'clientTimeZone', value: timeZone }]);
			});

			function onLogin() {
				if (mixpanel === 'undefined') {
					return;
				}

				var username = $('#username').val();
				mixpanel.track('Sign-in', { 'username': username},
					function() {
						if (typeof mixpanel !== 'undefined') {
							mixpanel.register({'username': username});
						}
					});
			}
		</script>
	</h:body>
</f:view>
</html>