<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<f:view contentType="text/html" encoding="UTF-8" oamEnableViewPool="true">
	<h:head>
		<ui:include src="/layout/headCommons.xhtml" />
	</h:head>
	
	<h:body>
		<p:ajaxStatus styleClass="ajax-status">
			<f:facet name="start">
				<i class="fa fa-spinner fa-pulse fa-fw" style="color: #a4a4a4; font-size: 100px;"></i>
			</f:facet>
		</p:ajaxStatus>

		<audio id="audio" />
		<p:tooltip />

		<div class="wrapper">
			<div class="header">
				<div class="header-left animate-0 fadeIn">
					<h:graphicImage id="logo" alt="#{msg['title.appTitle']}" value="/resources/images/logo.png" />
				</div>
				<div class="app-title hidden-xs animate-1 zoomInRight">
					<h:outputText value="#{msg['title.appTitle']}" />
				</div>
                <div class="top-menu">
					<ui:include src="/layout/topMenu.xhtml" />
				</div>
			</div>
			<div class="middle">
				<div class="container">
					<div class="inner-container">
						<h:panelGroup id="content" layout="block">
							<ui:include src="#{navigationController.activePage}" />
						</h:panelGroup>
					</div>
				</div>
			</div>
		</div>
		<footer class="footer hidden-xs">
			<p:link styleClass="animate-1 fadeIn text-primary" style="position: absolute; left: 15px; z-index: 2;" onclick="PF('helpDialog').show(); return false;"><i class="fa fa-question-circle" /> #{msg['title.help']}</p:link>
			<div class="animate-1 fadeIn">
				<span>#{msg['title.poweredBy']} &#8211;</span>
				<span class="animate-3 fadeIn" style="#{loginController.newVersion ? 'color: green' : ''}">#{version['version']} (#{version['versionUpdatedOn']} #{version['versionDate']})</span>
			</div>
		</footer>

		<p:dialog header="#{msg['title.help']}" widgetVar="helpDialog" width="50%" resizable="false" showEffect="fade" hideEffect="fade" modal="true">
			<h:form id="helpForm">
				<div class="form-group">
					<label for="helpMessage">#{msg['message.help']}</label>
					<p:inputTextarea id="helpMessage" value="#{userController.helpMessage}" class="form-control" rows="10" style="width: 100%;" />
				</div>
				<p:commandButton value="#{msg['button.cancel']}" type="button" onclick="PF('helpDialog').hide()" styleClass="btn-danger pull-right" />
				<p:commandButton value="#{msg['button.send']}" process="@this, helpMessage" oncomplete="PF('helpDialog').hide();" actionListener="#{userController.sendHelpMessageEmail()}" styleClass="btn-primary pull-right"/>
			</h:form>
		</p:dialog>

		<h:form>
			<p:remoteCommand name="refreshNavigation" process="@this" actionListener="#{navigationController.updateNavigation()}" />
		</h:form>

		<script>
			$(document).ready(function() {
				var url = location.href;
				url = url.substring(url.lastIndexOf('/'), url.length);
				refreshNavigation([{name: 'activePage', value: url}, {name: 'update', value: 'content'}]);
			});
		</script>
	</h:body>
</f:view>
</html>
