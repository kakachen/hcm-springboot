<ui:composition xmlns="http://www.w3.org/1999/xhtml"
				xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
				xmlns:f="http://xmlns.jcp.org/jsf/core"
				xmlns:h="http://xmlns.jcp.org/jsf/html"
				xmlns:p="http://primefaces.org/ui"
				xmlns:lc="http://java.sun.com/jsf/composite/components">
	
	<h:form id="patientsForm">  
		<p:growl id="messages" severity="info"/>

		<lc:headerPanel title="#{msg['title.patients']}" addButtonAction="#{patientManager.newPatient()}" update=":patientInputForm" oncomplete="PF('patientDialog').show()" />
	
		<div class="content-wrapper">
			<p:dataTable id="patientsTable" widgetVar="patientsTable" value="#{patientManager.patients}" var="patient" paginator="true" rows="15" paginatorAlwaysVisible="false" filteredValue="#{patientManager.filteredPatients}"
				paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" rowsPerPageTemplate="15,30,100,500" paginatorPosition="bottom" emptyMessage="#{msg['message.noData']}">
				
				<p:column headerText="#{msg['label.name']}" sortBy="#{patient.name}" style="text-align: left;">
	          		<h:outputText value="#{patient.name}" />
				</p:column>
				<p:column headerText="#{msg['label.cpf']}" width="100">
					<h:outputText value="#{patient.cpf}" converter="cpfConverter" />
				</p:column>
				<p:column headerText="#{msg['label.address']}" style="text-align: left;">
					<h:outputText value="#{patient.address.addressStreet}" />
					<h:outputText value="#{not empty patient.address.addressNumber ? ', ' : ''} #{patient.address.addressNumber}" />
					<h:outputText value="#{not empty patient.address.addressComplement ? ' / ' : ''} #{patient.address.addressComplement}" />
					<h:outputText value="#{not empty patient.address.city ? ' - ' : ''} #{patient.address.city}" />
					<h:outputText value="#{not empty patient.address.state ? ' - ' : ''} #{patient.address.state}" />
					<h:outputText value=" #{patient.address.zipCode}" />
				</p:column>
				<p:column headerText="#{msg['label.phone']}" width="100">
					<h:outputText value="#{patient.address.phoneNumber}" />
				</p:column>
				<p:column headerText="#{msg['label.email']}">
					<h:outputText value="#{patient.email}" />
				</p:column>
				<p:column headerText="#{msg['label.creationDate']}" sortBy="#{patient.creationDate}" width="120">
					<h:outputText value="#{patient.creationDate}">
						<f:convertDateTime pattern="dd/MM/yyyy" />
					</h:outputText>
				</p:column>
				<p:column headerText="#{msg['label.action']}" width="60">
					<p:commandButton process="@this" actionListener="#{patientManager.setPatient(patient)}" update=":patientInputForm" oncomplete="PF('patientDialog').show();" icon="ui-icon-pencil" title="#{msg['button.edit']}">
						<p:resetInput target=":patientInputForm:patientGrid" />
					</p:commandButton>
					<p:commandButton process="@this" actionListener="#{patientManager.setPatient(patient)}" onclick="PF('confirmDeletePatientDialog').show();" icon="ui-icon-trash" title="#{msg['button.delete']}" />
				</p:column>
			</p:dataTable>
		</div>
	</h:form>
	
	<h:form id="patientInputForm">
		<ui:param name="patient" value="#{patientManager.patient}" />
		<p:dialog header="#{patient.patientId eq null ? msg['title.newPatient'] : msg['title.editPatient']}" widgetVar="patientDialog" resizable="false" showEffect="fade" modal="true">
			<p:messages id="dialogMessages" autoUpdate="true" />
			
			<p:panelGrid id="patientGrid" columns="2">
				<p:outputLabel value="#{msg['label.name']}" for="patientName" />
				<p:inputText id="patientName" value="#{patient.name}" required="true" maxlength="150" size="50" />

				<p:outputLabel value="#{msg['label.email']}" for="patientEmail" />
				<p:inputText id="patientEmail" value="#{patient.email}" maxlength="75" size="50" />

				<p:outputLabel value="#{msg['label.phone']}" for="patientPhone" />
				<p:inputMask id="patientPhone" value="#{patient.address.phoneNumber}" mask="(99) ?999999999" maxlength="15" size="15" />

				<p:outputLabel value="#{msg['label.cpf']}" for="patientCpf" />
				<p:inputMask id="patientCpf" value="#{patient.cpf}" mask="999.999.999-99" converter="cpfConverter" validator="cpfValidator" size="15" />

				<p:outputLabel value="#{msg['label.rg']}" for="patientRg" />
				<p:inputText id="patientRg" value="#{patient.rg}" size="15" />

				<p:outputLabel value="#{msg['label.birthDate']}" for="patientBirthDate" />
				<p:calendar id="patientBirthDate" value="#{patient.birthDate}" pattern="dd/MM/yyyy" mask="true" yearRange="c-100:c+15" size="15" showOn="button" navigator="true" />

				<p:outputLabel value="#{msg['label.zipCode']}" for="patientZipCode" />
				<p:inputMask id="patientZipCode" widgetVar="zipCode" value="#{patient.address.zipCode}" mask="99999-999" onblur="if (PF('zipCode').getValue().length == 9) { onchange() } else return false;" size="15">
					<p:ajax event="change" listener="#{addressManager.loadAddressByZipCode(patient.address)}" update="patientAddress, patientNeighborhood, patientCity, patientState" />
				</p:inputMask>

				<p:outputLabel value="#{msg['label.address']}" for="patientAddress" />
				<p:inputText id="patientAddress" value="#{patient.address.addressStreet}" maxlength="150" size="50" />

				<p:outputLabel value="#{msg['label.number']}" for="patientAddressNumber"/>
				<p:inputText id="patientAddressNumber" value="#{patient.address.addressNumber}" maxlength="10"  size="10" />

				<p:outputLabel value="#{msg['label.addressComplement']}" for="patientAddressComplement" />
				<p:inputText id="patientAddressComplement" value="#{patient.address.addressComplement}" maxlength="50" size="10" />

				<p:outputLabel value="#{msg['label.neighborhood']}" for="patientNeighborhood" />
				<p:inputText id="patientNeighborhood" value="#{patient.address.neighborhood}" maxlength="50" />

				<p:outputLabel value="#{msg['label.city']}" for="patientCity" />
				<p:inputText id="patientCity" value="#{patient.address.city}" maxlength="100" />

				<p:outputLabel value="#{msg['label.state']}" for="patientState" />
				<p:selectOneMenu id="patientState" value="#{patient.address.state}">
					<f:selectItem itemLabel="" itemValue="#{null}" />
					<f:selectItems value="#{addressManager.states}" />
				</p:selectOneMenu>
			</p:panelGrid>

			<h:panelGrid columns="3">
				<p:commandButton value="#{msg['button.save']}" action="#{patientManager.savePatient}" process="@form" update=":patientsForm:patientsTable, :patientsForm:messages" oncomplete="if (!args.validationFailed) { PF('patientDialog').hide(); PF('patientsTable').clearFilters(); }" validateClient="true"/>
				<p:commandButton value="#{msg['button.cancel']}" type="button" onclick="PF('patientDialog').hide()" />
			</h:panelGrid>
		</p:dialog>
	</h:form>

	<h:form id="confirmDeletePatientForm">
		<p:confirmDialog message="#{msg['confirmation.deletePacient']}" header="#{msg['title.deletePatient']}" severity="alert" widgetVar="confirmDeletePatientDialog">
			<p:messages autoUpdate="true" />
			<p:commandButton value="#{msg['button.delete']}" actionListener="#{patientManager.deletePatient}" process="@form" update=":patientsForm:messages, :patientsForm:patientsTable" oncomplete="if (!args.validationFailed) { PF('confirmDeletePatientDialog').hide(); PF('patientsTable').clearFilters(); }" />
			<p:commandButton value="#{msg['button.cancel']}" onclick="PF('confirmDeletePatientDialog').hide();" />
		</p:confirmDialog>
	</h:form>

	<script type="text/javascript">
       	$(document).ready(function() {
       		PF('patientsTable').clearFilters();
		});
	</script>
</ui:composition>